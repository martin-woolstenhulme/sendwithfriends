jQuery.sharedCount = function(url, fn) {
	url = encodeURIComponent(url || location.href);
	var arg = {
		data: {
			url : url,
			apikey : "3cf8fcf612b51f448e41d579156aba6baac21107"
		},
		url: "//" + (location.protocol == "https:" ? "sharedcount.appspot" : "api.sharedcount") + ".com/",
		cache: true,
		dataType: "json"
	};
	if ('withCredentials' in new XMLHttpRequest) {
		arg.success = fn;
	}
	else {
		var cb = "sc_" + url.replace(/\W/g, '');
		window[cb] = fn;
		arg.jsonpCallback = cb;
		arg.dataType += "p";
	}
	return jQuery.ajax(arg);
};
jQuery(document).ready(function () {
		// New Items Counter START
		var headerCount = 0;
		jQuery('.countable').each(function () {
			var itemId = jQuery(this).attr('id');
			var itemsCount = jQuery(this).find('a').attr('data-count');
			var itemsCount = parseInt(itemsCount, 10);
			var storageValue = jQuery.jStorage.get(itemId); // Check if "storageValue" exists in the storage
			if(!storageValue && storageValue != 0){ // if not - assign current number of items
				storageValue = itemsCount;
				jQuery.jStorage.set(itemId,storageValue, {TTL: 86400000}); // and save it
			}
			var diff = itemsCount-storageValue;
			if (diff > 0) {
				jQuery(this).find('.ui-li-count').html(diff).removeClass('hidden');
			}else if (diff < 0) {
				jQuery.jStorage.set(itemId,itemsCount, {TTL: 86400000}); // reset value if items have been removed
			}
			headerCount = headerCount+diff;
		});
		if (headerCount > 0) {
			jQuery('.counter-header').html(headerCount).removeClass('hidden');
		}
		jQuery('.countable').on('click', function() {
			var strKey = jQuery(this).attr('id');
			var strValue = jQuery(this).find('a').attr('data-count');
			jQuery.jStorage.set(strKey,strValue, {TTL: 86400000}); // null the counter
		});
		// New Items Counter END
		// Share Counter START
		var current_url = document.location.href;
		jQuery(".facebook_share_link").attr('href', 'http://www.facebook.com/sharer/sharer.php?u='+current_url+'');
		jQuery(".twitter_share_link").attr('href', 'http://twitter.com/intent/tweet?text=Check out&url='+current_url+'');
		jQuery(".google_share_link").attr('href', 'https://plus.google.com/share?url='+current_url+'');
		jQuery.sharedCount(location.href, function(data){
			if (data.Twitter !== 'undefined'){
				jQuery(".twitter_number").text(data.Twitter);
			}else{
				jQuery(".twitter_number").text('error');
			}
			if (data.Facebook.like_count !== 'undefined'){
				jQuery(".facebook_number").text(data.Facebook.like_count);
			}else{
				jQuery(".facebook_number").text('error');
			}
			if (data.GooglePlusOne !== 'undefined'){
				jQuery(".google_number").text(data.GooglePlusOne);
			}else{
				jQuery(".google_number").text('error');
			}
		});
		// Share Counter END
		jQuery('.ui-page-active .disqus-inactive').addClass('disqus-active').removeClass('disqus-inactive').attr('id','disqus_thread');
		jQuery('.ui-page-active .owl-carousel').addClass('owl-active');
		// Touch Slider START
		jQuery('.owl-active').owlCarousel({
			items: 3,
			itemsDesktop : [1000,3], // between 1000px and 901px
			itemsDesktopSmall : [900,2], // betweem 900px and 601px
			itemsTablet: [600,2], // between 600 and 0
			autoPlay: 3000
		});
		// Touch Slider END

		// Validation START
		jQuery("#admin_page form").validate({
			rules: {
				storage_ttl: {
					minlength: 0
				}
			}
		});
		// Validation END

		// Video START
		jQuery( 'body' ).on('popupbeforeposition', '.ui-page-active .video-popup', function(){
			var size = scale( 640, 480, 15, 1 ),
				w = size.width,
				h = size.height;
			jQuery(this).find('iframe').attr( "width", w ).attr( "height", h );
		});
		jQuery( 'body' ).on('popupafterclose', '.ui-page-active .video-popup', function(){
			var videoSrc = jQuery(this).find('iframe').attr('src');
			jQuery(this).find('iframe').attr('src', videoSrc);
		});
		jQuery('.ui-content').on('click', '.alert', function(){
			jQuery(this).fadeOut();
		});
		function scale( width, height, padding, border ) {
			var scrWidth = jQuery( window ).width() - 30,
				scrHeight = jQuery( window ).height() - 30,
				ifrPadding = 2 * padding,
				ifrBorder = 2 * border,
				ifrWidth = width + ifrPadding + ifrBorder,
				ifrHeight = height + ifrPadding + ifrBorder,
				h, w;

			if ( ifrWidth < scrWidth && ifrHeight < scrHeight ) {
				w = ifrWidth;
				h = ifrHeight;
			} else if ( ( ifrWidth / scrWidth ) > ( ifrHeight / scrHeight ) ) {
				w = scrWidth;
				h = ( scrWidth / ifrWidth ) * ifrHeight;
			} else {
				h = scrHeight;
				w = ( scrHeight / ifrHeight ) * ifrWidth;
			}

			return {
				'width': w - ( ifrPadding + ifrBorder ),
				'height': h - ( ifrPadding + ifrBorder )
			};
		};
		// Video END

		// Touch Gallery START
		if ( jQuery('.gallery').hasClass('gallery-active') ) {
			var myPhotoSwipe = jQuery(".gallery-active a").photoSwipe({ enableMouseWheel: false , enableKeyboard: false });
		}
		// Touch Gallery END

		jQuery( 'body' ).on( "pagebeforeload", function( event ) {
			jQuery('#disqus_thread').empty().removeClass('disqus-active').addClass('disqus-inactive').removeAttr('id');
			jQuery('.ui-page-active .owl-carousel').removeClass('owl-active');
			jQuery('.gallery').removeClass('gallery-active');
		});
		jQuery( 'body' ).on( "pagechange", function( event, ui ) {
			jQuery('.ui-content').on('click', '.alert', function(){
				jQuery(this).fadeOut();
			});
			// Validation START
			jQuery("#admin_page form").validate({
				rules: {
					storage_ttl: {
						minlength: 0
					}
				}
			});
			// Validation END

			// Share Counter START
			var current_url = document.location.href;
			jQuery(".ui-page-active .facebook_share_link").attr('href', 'http://www.facebook.com/sharer/sharer.php?u='+current_url+'');
			jQuery(".ui-page-active .twitter_share_link").attr('href', 'http://twitter.com/intent/tweet?text=Check out&url='+current_url+'');
			jQuery(".ui-page-active .google_share_link").attr('href', 'https://plus.google.com/share?url='+current_url+'');
			jQuery.sharedCount(location.href, function(data){
				jQuery(".ui-page-active .twitter_number").text(data.Twitter);
				jQuery(".ui-page-active .facebook_number").text(data.Facebook.like_count);
				jQuery(".ui-page-active .google_number").text(data.GooglePlusOne);
			});
			// Share Counter END

			// New Items Counter START
			headerCount = 0;
			jQuery('.ui-page-active .countable').each(function () {
				var itemId = jQuery(this).attr('id');
				var itemsCount = jQuery(this).find('a').attr('data-count');
				var itemsCount = parseInt(itemsCount, 10);
				var currentCounter = jQuery.jStorage.get(itemId);
				currentCounter = parseInt(currentCounter, 10);
				var diff = itemsCount-currentCounter;
				if (diff > 0) {
					jQuery(this).find('.ui-li-count').html(diff).removeClass('hidden');
				}else if (diff <= 0) {
					jQuery(this).find('.ui-li-count').html(diff).addClass('hidden');
				}
				headerCount = headerCount+diff;
			});
			if (headerCount > 0) {
				jQuery('.counter-header').html(headerCount).removeClass('hidden');
			}else{
				jQuery('.counter-header').html(headerCount).addClass('hidden');
			}
			// New Items Counter END
			if ( jQuery('.disqus-wrap').length == 1 ) {
				jQuery('.disqus-inactive').addClass('disqus-active').removeClass('disqus-inactive').attr('id','disqus_thread');
			}else{
				jQuery('.ui-page-active .disqus-inactive').addClass('disqus-active').removeClass('disqus-inactive').attr('id','disqus_thread');
			}
			jQuery('.ui-page-active .owl-carousel').addClass('owl-active');
			if ( jQuery('.ui-page-active .owl-carousel').hasClass('owl-active') ) {
				// Touch Slider START
				jQuery('.ui-page-active .owl-active').owlCarousel({
					items: 3,
					itemsDesktop : [1000,3], // between 1000px and 901px
					itemsDesktopSmall : [900,2], // betweem 900px and 601px
					itemsTablet: [600,2], // between 600 and 0
					autoPlay: 3000
				});
				// Touch Slider END
			}
			if ( jQuery('.gallery').hasClass('gallery-active') ) {
				var myPhotoSwipe = jQuery(".gallery-active a").photoSwipe({ enableMouseWheel: false , enableKeyboard: false });
			}
			jQuery('.menu-btn-background').removeClass('accent-color');
			if(jQuery('.ui-page-active .disqus-wrap').hasClass('disqus-active')){
				DISQUS.reset({
					reload: true,
					config: function () {
						this.page.identifier = jQuery('.ui-page-active .page_title').html().replace(/ /g,'-');
						this.page.url = document.location.href;
						this.page.title = jQuery('.ui-page-active .page_title').html();
					}
				});
			}
		});
		jQuery( document ).on( "panelopen", "#left_panel", function( event, ui ) {
			jQuery('.menu-btn-background').addClass('accent-color');
		});
		jQuery( 'body' ).on( "panelclose", "#left_panel", function( event, ui ) {
			jQuery('.menu-btn-background').removeClass('accent-color');
		});
		jQuery( document ).on( "panelopen", "#right_panel", function( event, ui ) {
			jQuery('.share-btn-background').addClass('accent-color');
		});
		jQuery( 'body' ).on( "panelclose", "#right_panel",  function( event, ui ) {
			jQuery('.share-btn-background').removeClass('accent-color');
		});
		var disqus_shortname = 'lemonado'; // Required - Replace example with your forum shortname
		var disqus_identifier = jQuery('.ui-page-active .page_title').html().replace(/ /g,'-');
		var disqus_title = jQuery('.ui-page-active .page_title').html();
		var disqus_url = document.location.href;
});
